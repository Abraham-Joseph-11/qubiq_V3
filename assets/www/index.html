<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyBlocks - Block-Based Python Editor</title>
    <meta name="description"
        content="Learn Python programming with drag-and-drop blocks. A visual coding environment for students.">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Blockly Core -->
    <script src="lib/blockly/blockly_compressed.js"></script>
    <script src="lib/blockly/blocks_compressed.js"></script>
    <script src="lib/blockly/python_compressed.js"></script>
    <script src="lib/blockly/en.js"></script>

    <!-- Skulpt for Python execution -->
    <script src="lib/skulpt/skulpt.min.js"></script>
    <script src="lib/skulpt/skulpt-stdlib.js"></script>
    <!-- Plotting Support (Chart.js + Skulpt Wrapper) -->
    <script src="lib/skulpt/chart.min.js"></script>
    <script src="lib/skulpt/plt_wrapper.js"></script>
    <!-- MySQL Mock for Skulpt -->
    <script src="lib/skulpt/mysql_mock.js"></script>
    <!-- AI & Data Science Mocks for Skulpt -->
    <script src="lib/skulpt/ai_ds_mocks.js"></script>

    <!-- CodeMirror for code display -->
    <link rel="stylesheet" href="lib/codemirror/codemirror.min.css">
    <link rel="stylesheet" href="lib/codemirror/dracula.min.css">
    <script src="lib/codemirror/codemirror.min.js"></script>
    <script src="lib/codemirror/python.min.js"></script>

    <!-- App Styles -->
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <!-- Header - EMMI BOT Style -->


    <header class="header">
        <div class="header-left">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                </svg>
                <span class="logo-text">PyBlocks</span>
            </div>
            <input type="text" class="project-name-input" id="projectName" placeholder="Project name"
                value="My Project">
        </div>
        <div class="header-center">
            <div class="toolbar">
                <!-- File Operations -->
                <button class="btn btn-icon" id="saveBtn" title="Save Project">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z" />
                        <polyline points="17,21 17,13 7,13 7,21" />
                        <polyline points="7,3 7,8 15,8" />
                    </svg>
                </button>
                <button class="btn btn-icon" id="loadBtn" title="Load Project">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z" />
                    </svg>
                </button>
                <div class="separator"></div>
                <!-- Undo/Redo -->
                <button class="btn btn-icon" id="undoBtn" title="Undo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 10h10a5 5 0 0 1 5 5v2M3 10l5-5M3 10l5 5" />
                    </svg>
                </button>
                <button class="btn btn-icon" id="redoBtn" title="Redo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10H11a5 5 0 0 0-5 5v2M21 10l-5-5M21 10l-5 5" />
                    </svg>
                </button>
                <div class="separator"></div>
                <!-- Clear -->
                <button class="btn btn-icon" id="clearBtn" title="Clear Workspace">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" />
                    </svg>
                </button>
                <div class="separator"></div>
                <!-- Serial Connect -->
                <button class="btn btn-connect" id="connectSerialBtn" title="Connect to Serial Device">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14" />
                    </svg>
                    <span>Connect</span>
                </button>
                <!-- Theme Toggle -->
                <button class="btn btn-icon theme-toggle" id="themeToggleBtn" title="Toggle Light/Dark Theme">
                    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                    </svg>
                </button>
            </div>
        </div>

        <div class="header-right">
            <!-- Run Button - Large Green -->
            <button class="btn btn-run" id="runBtn" title="Run Code (Ctrl+Enter)">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z" />
                </svg>
            </button>
            <button class="btn btn-stop" id="stopBtn" title="Stop Execution" disabled>
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <rect x="6" y="6" width="12" height="12" />
                </svg>
            </button>
        </div>
    </header>


    <!-- Main Content -->
    <main class="main-content">
        <!-- Blocks Panel -->
        <div class="panel panel-blocks" id="blocksPanel">
            <div class="panel-header blocks-header">
                <h2>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                    BLOCKS
                </h2>
            </div>
            <div id="blocklyDiv"></div>
        </div>


        <!-- Resizer -->
        <div class="resizer resizer-h" id="resizer1"></div>

        <!-- Code and Output Group (Right Side) -->
        <div class="main-right" id="mainRight">
            <!-- Code Panel -->
            <div class="panel panel-code" id="codePanel">
                <div class="panel-header">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6" />
                            <polyline points="8 6 2 12 8 18" />
                        </svg>
                        Python Code
                    </h2>
                    <button class="btn btn-small" id="copyCodeBtn" title="Copy Code">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                            <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" />
                        </svg>
                    </button>
                </div>
                <div class="code-container">
                    <textarea id="codeArea"></textarea>
                </div>
            </div>

            <!-- Resizer (Vertical) -->
            <div class="resizer resizer-v" id="resizer2"></div>

            <!-- Output Panel -->
            <div class="panel panel-output" id="outputPanel">
                <div class="panel-header">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="4 17 10 11 4 5" />
                            <line x1="12" y1="19" x2="20" y2="19" />
                        </svg>
                        Output
                    </h2>
                    <button class="btn btn-small" id="clearOutputBtn" title="Clear Output">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6" />
                        </svg>
                    </button>
                </div>
                <div class="output-container" id="outputContainer">
                    <div class="output-content" id="output">
                        <div class="welcome-message">
                            <span class="emoji">üêç</span>
                            <p>Welcome to <strong>PyBlocks</strong>!</p>
                            <p class="hint">Drag blocks from the toolbox and click <strong>Run</strong> to execute your
                                code.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Plot Modal -->
    <div id="plotModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><span class="emoji">üìà</span> Visualization</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modalCanvasContainer"></div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for loading projects -->
    <input type="file" id="fileInput" accept=".json,.pyblocks" style="display: none;">

    <!-- Webcam Preview Container -->
    <div id="webcamContainer" class="webcam-container">
        <div class="webcam-header">
            <span>üì∑ Live Camera</span>
        </div>
        <video id="webcamPreview" autoplay playsinline></video>
        <canvas id="webcamCanvas" style="display:none;"></canvas>
    </div>

    <!-- Toolbox Definition -->
    <xml id="toolbox" style="display: none;">
        <!-- Category 1: Variables & Core Tokens -->
        <category name="üíé Variables & Tokens" colour="#4C97FF">
            <label text="Literals"></label>
            <block type="math_number">
                <field name="NUM">0</field>
            </block>
            <block type="text">
                <field name="TEXT">Hello</field>
            </block>
            <block type="python_string_multi"></block>
            <block type="python_boolean"></block>

            <label text="Assignments"></label>
            <button text="Create Variable..." callbackKey="CREATE_VARIABLE"></button>
            <block type="variables_get"></block>
            <block type="variables_set"></block>
            <block type="python_assign_aug"></block>

            <label text="Type Casting"></label>
            <block type="python_int"></block>
            <block type="python_float"></block>
            <block type="python_str"></block>
            <block type="python_type"></block>
        </category>

        <!-- Category 2: Operators & Logic -->
        <category name="‚öñÔ∏è Operators & Logic" colour="#5C68A6">
            <label text="Arithmetic"></label>
            <block type="math_arithmetic"></block>
            <block type="python_arithmetic_adv"></block>

            <label text="Relational"></label>
            <block type="logic_compare"></block>

            <label text="Logical"></label>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>

            <label text="Membership & Identity"></label>
            <block type="python_logic_membership"></block>
        </category>

        <!-- Category 3: Control Flow -->
        <category name="üîÑ Control Flow" colour="#5CA65C">
            <label text="Conditionals"></label>
            <block type="controls_if"></block>

            <label text="Iteration"></label>
            <block type="python_for_range"></block>
            <block type="controls_whileUntil"></block>
            <block type="controls_forEach"></block>

            <label text="Jump Statements"></label>
            <block type="python_jump_break"></block>
            <block type="python_jump_continue"></block>
            <block type="python_jump_pass"></block>
        </category>

        <!-- Category 4: Built-in Data Structures -->
        <category name="üì¶ Data Structures" colour="#745CA6">
            <label text="Strings"></label>
            <block type="python_string_method"></block>

            <label text="Lists"></label>
            <block type="lists_create_with"></block>
            <block type="python_list_method"></block>
            <block type="lists_getIndex"></block>

            <label text="Tuples"></label>
            <block type="python_tuple_create"></block>

            <label text="Dictionaries"></label>
            <block type="dict_create"></block>
            <block type="dict_set"></block>
            <block type="dict_get"></block>
        </category>

        <!-- Category 5: Modular Programming -->
        <category name="üöÄ Modular Programming" colour="#9A5CA6">
            <label text="Functions"></label>
            <button text="Create Function..." callbackKey="CREATE_FUNCTION"></button>
            <block type="procedures_defnoreturn"></block>
            <block type="procedures_callnoreturn"></block>

            <label text="Modules"></label>
            <block type="python_module_import"></block>

            <label text="Math & Random"></label>
            <block type="python_math_random"></block>
        </category>

        <!-- Category 6: Data Management -->
        <category name="üíæ Data Management" colour="#A65C81">
            <label text="Text Files"></label>
            <block type="file_open"></block>
            <block type="file_read"></block>
            <block type="python_file_readline"></block>
            <block type="python_file_readlines"></block>
            <block type="file_write"></block>
            <block type="python_file_writelines"></block>
            <block type="file_close"></block>

            <label text="Binary Files (Pickle)"></label>
            <block type="python_pickle"></block>

            <label text="CSV Files"></label>
            <block type="python_csv_op"></block>
        </category>

        <!-- Category 7: Advanced Data & DB -->
        <category name="üìä Advanced & DB" colour="#DB61A2">
            <label text="Linear Stack"></label>
            <block type="python_stack_pushpop"></block>
            <block type="python_stack_empty"></block>

            <label text="SQL Interface"></label>
            <block type="mysql_connect"></block>
            <block type="mysql_execute"></block>

        </category>

        <!-- Category B: Data Science (Pandas) -->
        <category name="üêº Data Science (Pandas)" colour="#FFD700">
            <label text="Data Loading"></label>
            <block type="pandas_load_csv"></block>
            <label text="Inspection"></label>
            <block type="pandas_df_inspect"></block>
            <block type="pandas_df_describe"></block>
            <label text="Cleaning"></label>
            <block type="pandas_df_cleaning"></block>
        </category>

        <!-- Category C: Visualization (Matplotlib) -->
        <category name="üìà Visualization" colour="#DB61A2">
            <label text="Plot Setup"></label>
            <block type="plt_plot">
                <value name="X">
                    <block type="lists_create_with">
                        <mutation items="3"></mutation>
                    </block>
                </value>
                <value name="Y">
                    <block type="lists_create_with">
                        <mutation items="3"></mutation>
                    </block>
                </value>
            </block>
            <block type="plt_plot_type"></block>
            <block type="plt_bar"></block>
            <block type="plt_pie"></block>
            <label text="Labels & Legends"></label>
            <block type="plt_plot_labels"></block>
            <block type="plt_legend"></block>
            <label text="Display"></label>
            <block type="plt_show"></block>
        </category>

        <!-- Category D: Machine Learning -->
        <category name="üß† Machine Learning" colour="#6A5ACD">
            <label text="Preprocessing"></label>
            <block type="ml_train_test_split"></block>
            <label text="Modeling"></label>
            <block type="ml_init_model"></block>
            <block type="ml_fit_model"></block>
            <block type="ml_predict_model"></block>
            <label text="Evaluation"></label>
            <block type="ml_check_accuracy"></block>
        </category>

        <!-- Category E: Facial Feature -->
        <category name="üë§ Facial Feature" colour="#00A8A8">
            <block type="facial_load"></block>
            <block type="facial_get_count"></block>
            <block type="facial_gender_count"></block>
            <block type="facial_expression_count"></block>
            <block type="facial_age_list"></block>
            <block type="facial_show"></block>
        </category>

        <!-- Category F: Object Detection -->
        <category name="üîç Object Detection" colour="#008B8B">
            <block type="obj_load"></block>
            <block type="obj_count"></block>
            <block type="obj_show"></block>
        </category>

        <!-- Category G: AI Domains -->
        <category name="ü§ñ AI Domains" colour="#00CED1">
            <label text="Computer Vision (CV)"></label>
            <block type="cv_load_image"></block>
            <block type="cv_load_local"></block>
            <block type="cv_convert_gray"></block>
            <block type="cv_resize"></block>
            <block type="cv_blur"></block>
            <block type="cv_canny"></block>
            <label text="Drawing Tools"></label>
            <block type="cv_rectangle"></block>
            <block type="cv_put_text"></block>
            <label text="Display"></label>
            <block type="cv_show_image"></block>
            <block type="cv_wait_key"></block>
            <label text="Natural Language Processing (NLP)"></label>
            <block type="nlp_analyze_sentiment"></block>
        </category>

        <!-- Category TM: Teachable Machine -->
        <category name="üß† Teachable" colour="#6A5ACD">
            <label text="Image Models"></label>
            <block type="tm_load_model">
                <field name="URL">https://teachablemachine.withgoogle.com/models/model_id/</field>
            </block>
            <block type="tm_webcam_on"></block>
            <block type="tm_webcam_capture"></block>
            <block type="tm_classify_image"></block>
            <block type="tm_get_prediction">
                <field name="CLASS">Class 1</field>
            </block>
            <block type="tm_webcam_off"></block>
            <label text="Audio/Voice Models"></label>
            <block type="tm_load_audio_model">
                <field name="URL">https://teachablemachine.withgoogle.com/models/audio_model_id/</field>
            </block>
            <block type="tm_mic_on"></block>
            <block type="tm_listen"></block>
            <block type="tm_classify_audio"></block>
            <block type="tm_mic_off"></block>
        </category>

        <!-- Category G: Speak -->
        <category name="üîä Speak" colour="#FF6347">
            <block type="speak_text"></block>
        </category>

        <!-- Category H: Serial -->
        <category name="üñ•Ô∏è Serial" colour="#000080">
            <block type="serial_init"></block>
            <block type="serial_send">
                <value name="DATA">
                    <block type="text">
                        <field name="TEXT"></field>
                    </block>
                </value>
            </block>
            <block type="serial_read"></block>
            <block type="serial_available"></block>
        </category>
    </xml>

    <!-- App Scripts -->
    <script src="blocks/python-blocks.js"></script>
    <script src="blocks/custom_blocks.js"></script>
    <script src="app.js"></script>
</body>

</html>