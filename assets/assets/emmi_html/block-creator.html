<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Creator Tool - EMMI BOT V2</title>
    <link rel="icon" type="image/png" href="media/logo.png">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/block-creator.css">
</head>

<body>
    <!-- Header -->
    <header class="creator-header">
        <div class="header-left">
            <div class="logo">
                <img src="media/logo.png" alt="Logo" onerror="this.style.display='none'">
            </div>
            <h1>Block Creator Tool</h1>
        </div>
        <div class="header-actions">
            <button id="btn-cloud-settings" class="btn btn-info" title="Configure AWS Cloud Upload">
                <i class="fas fa-cloud"></i> Cloud Settings
            </button>
            <button id="btn-clear-cache" class="btn btn-warning" title="Clear Cache and Reset">
                <i class="fas fa-trash"></i> Clear Cache
            </button>
            <button id="btn-auto-sync" class="btn btn-info" title="Enable Auto-Sync to Project">
                <i class="fas fa-folder-open"></i> <span id="auto-sync-text">Enable Auto-Sync</span>
            </button>
            <button id="btn-import-app" class="btn btn-primary" title="Import from Main App">
                <i class="fas fa-sync"></i> Import from App
            </button>
            <button id="btn-import" class="btn btn-secondary" title="Import Configuration">
                <i class="fas fa-upload"></i> Import Config
            </button>
            <button id="btn-export" class="btn btn-secondary" title="Export Configuration">
                <i class="fas fa-download"></i> Export Config
            </button>
            <button id="btn-generate" class="btn btn-primary" title="Generate Files for Main App">
                <i class="fas fa-code"></i> Generate Files
            </button>
            <button id="btn-sync-server" class="btn btn-success" title="Save &amp; Sync files to the running app via server API">
                <i class="fas fa-sync-alt"></i> Save &amp; Sync
            </button>
            <button id="btn-export-app" class="btn btn-secondary" title="Download EMMI BOT Lite as a ZIP (no editor files)">
                <i class="fas fa-file-archive"></i> Export App
            </button>
            <button id="btn-save" class="btn btn-success" title="Save All Changes">
                <i class="fas fa-save"></i> Save
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="creator-body">
        <!-- Sidebar: Board List -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Boards</h2>
                <button id="btn-new-board" class="btn-icon" title="Add New Board">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div id="board-list" class="board-list">
                <!-- Boards will be populated here -->
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Category Section -->
            <section class="content-section">
                <div class="section-header">
                    <h2>Categories <span id="current-board-name" class="board-badge"></span></h2>
                    <button id="btn-add-category" class="btn btn-small" disabled>
                        <i class="fas fa-plus"></i> Add Category
                    </button>
                </div>
                <div id="category-list" class="item-list">
                    <div class="empty-state">
                        <i class="fas fa-layer-group"></i>
                        <p>Select a board to manage categories</p>
                    </div>
                </div>
            </section>

            <!-- Block Section -->
            <section class="content-section">
                <div class="section-header">
                    <h2>Blocks <span id="current-category-name" class="category-badge"></span></h2>
                    <button id="btn-add-block" class="btn btn-small" disabled>
                        <i class="fas fa-plus"></i> Add Block
                    </button>
                </div>
                <div id="block-list" class="item-list">
                    <div class="empty-state">
                        <i class="fas fa-cube"></i>
                        <p>Select a category to manage blocks</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal: New/Edit Board -->
    <div id="modal-board" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="board-modal-title">New Board</h3>
                <button class="btn-close" data-modal="modal-board">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Board ID</label>
                    <input type="text" id="board-id" placeholder="e.g., emmi-bot-v2" />
                </div>
                <div class="form-group">
                    <label>Board Name</label>
                    <input type="text" id="board-name" placeholder="e.g., EMMI BOT V2" />
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="modal-board">Cancel</button>
                <button id="btn-save-board" class="btn btn-primary">Save Board</button>
            </div>
        </div>
    </div>

    <!-- Modal: New/Edit Category -->
    <div id="modal-category" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="category-modal-title">New Category</h3>
                <button class="btn-close" data-modal="modal-category">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Category ID</label>
                    <input type="text" id="category-id" placeholder="e.g., eyes" />
                </div>
                <div class="form-group">
                    <label>Category Name (with emoji)</label>
                    <div class="input-with-emoji">
                        <input type="text" id="category-name" placeholder="e.g., ğŸ‘€ Eyes" />
                        <button type="button" class="btn-emoji-picker" id="btn-emoji-picker" title="Pick Emoji">
                            ğŸ˜€
                        </button>
                        <!-- Emoji picker MUST be inside input-with-emoji for correct positioning -->
                        <div id="emoji-picker" class="emoji-picker hidden">
                            <div class="emoji-grid">
                                <!-- Structure & Tools -->
                                <button type="button" class="emoji-option">ğŸ”§</button>
                                <button type="button" class="emoji-option">ğŸ”¨</button>
                                <button type="button" class="emoji-option">âš™ï¸</button>
                                <button type="button" class="emoji-option">ğŸ› ï¸</button>
                                <button type="button" class="emoji-option">ğŸ”©</button>

                                <!-- Sensors -->
                                <button type="button" class="emoji-option">ğŸ‘€</button>
                                <button type="button" class="emoji-option">ğŸ‘ï¸</button>
                                <button type="button" class="emoji-option">ğŸ‘‚</button>
                                <button type="button" class="emoji-option">â˜</button>
                                <button type="button" class="emoji-option">ğŸ”¦</button>

                                <!-- Motors & Movement -->
                                <button type="button" class="emoji-option">ğŸ’ª</button>
                                <button type="button" class="emoji-option">ğŸš—</button>
                                <button type="button" class="emoji-option">ğŸï¸</button>
                                <button type="button" class="emoji-option">ğŸš€</button>
                                <button type="button" class="emoji-option">âœˆï¸</button>
                                <button type="button" class="emoji-option">ğŸ›¸</button>

                                <!-- Audio -->
                                <button type="button" class="emoji-option">ğŸ”Š</button>
                                <button type="button" class="emoji-option">ğŸ””</button>
                                <button type="button" class="emoji-option">ğŸµ</button>
                                <button type="button" class="emoji-option">ğŸ¶</button>
                                <button type="button" class="emoji-option">ğŸ“¢</button>

                                <!-- Light & Display -->
                                <button type="button" class="emoji-option">ğŸ’¡</button>
                                <button type="button" class="emoji-option">ğŸ”†</button>
                                <button type="button" class="emoji-option">ğŸŒŸ</button>
                                <button type="button" class="emoji-option">âœ¨</button>
                                <button type="button" class="emoji-option">ğŸ¨</button>
                                <button type="button" class="emoji-option">ğŸŒˆ</button>

                                <!-- Time & Control -->
                                <button type="button" class="emoji-option">â±ï¸</button>
                                <button type="button" class="emoji-option">â°</button>
                                <button type="button" class="emoji-option">â²ï¸</button>
                                <button type="button" class="emoji-option">ğŸ•</button>
                                <button type="button" class="emoji-option">ğŸ”„</button>
                                <button type="button" class="emoji-option">ğŸ”</button>
                                <button type="button" class="emoji-option">ğŸ›ï¸</button>

                                <!-- Math & Data -->
                                <button type="button" class="emoji-option">ğŸ”¢</button>
                                <button type="button" class="emoji-option">â•</button>
                                <button type="button" class="emoji-option">â–</button>
                                <button type="button" class="emoji-option">âœ–ï¸</button>
                                <button type="button" class="emoji-option">â—</button>
                                <button type="button" class="emoji-option">ğŸ“Š</button>
                                <button type="button" class="emoji-option">ğŸ“ˆ</button>
                                <button type="button" class="emoji-option">ğŸ“‰</button>

                                <!-- Electronics -->
                                <button type="button" class="emoji-option">ğŸ”Œ</button>
                                <button type="button" class="emoji-option">ğŸ”‹</button>
                                <button type="button" class="emoji-option">âš¡</button>
                                <button type="button" class="emoji-option">ğŸ’¾</button>
                                <button type="button" class="emoji-option">ğŸ’¿</button>

                                <!-- Communication -->
                                <button type="button" class="emoji-option">ğŸ“¡</button>
                                <button type="button" class="emoji-option">ğŸ“±</button>
                                <button type="button" class="emoji-option">ğŸ“</button>
                                <button type="button" class="emoji-option">ğŸ“Ÿ</button>
                                <button type="button" class="emoji-option">ğŸ“»</button>
                                <button type="button" class="emoji-option">ğŸŒ</button>

                                <!-- Computing -->
                                <button type="button" class="emoji-option">ğŸ–¥ï¸</button>
                                <button type="button" class="emoji-option">ğŸ’»</button>
                                <button type="button" class="emoji-option">âŒ¨ï¸</button>
                                <button type="button" class="emoji-option">ğŸ–±ï¸</button>
                                <button type="button" class="emoji-option">ğŸ–¨ï¸</button>

                                <!-- Robots & AI -->
                                <button type="button" class="emoji-option">ğŸ¤–</button>
                                <button type="button" class="emoji-option">ğŸ¦¾</button>
                                <button type="button" class="emoji-option">ğŸ¦¿</button>

                                <!-- Environment & Sensors -->
                                <button type="button" class="emoji-option">ğŸŒ¡ï¸</button>
                                <button type="button" class="emoji-option">ğŸŒ¤ï¸</button>
                                <button type="button" class="emoji-option">ğŸ’¨</button>
                                <button type="button" class="emoji-option">ğŸ’§</button>

                                <!-- Games & Fun -->
                                <button type="button" class="emoji-option">ğŸ®</button>
                                <button type="button" class="emoji-option">ğŸ¯</button>
                                <button type="button" class="emoji-option">ğŸ²</button>
                                <button type="button" class="emoji-option">ğŸ†</button>

                                <!-- Science -->
                                <button type="button" class="emoji-option">ğŸ§ª</button>
                                <button type="button" class="emoji-option">ğŸ”¬</button>
                                <button type="button" class="emoji-option">ğŸ§¬</button>
                                <button type="button" class="emoji-option">âš—ï¸</button>

                                <!-- Navigation -->
                                <button type="button" class="emoji-option">ğŸ§­</button>
                                <button type="button" class="emoji-option">ğŸ“</button>
                                <button type="button" class="emoji-option">ğŸ—ºï¸</button>

                                <!-- Others -->
                                <button type="button" class="emoji-option">ğŸ“¦</button>
                                <button type="button" class="emoji-option">ğŸ</button>
                                <button type="button" class="emoji-option">ğŸ”‘</button>
                                <button type="button" class="emoji-option">ğŸ”’</button>
                                <button type="button" class="emoji-option">ğŸ”“</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <input type="color" id="category-colour" value="#424242" />
                    <input type="text" id="category-colour-text" value="#424242" />
                </div>

                <!-- Quick-add blocks section -->
                <div class="form-section" style="margin-top: 12px; border-top: 1px solid #e0e0e0; padding-top: 12px;">
                    <h4>Quick-Add Blocks (optional)</h4>
                    <p style="font-size: 12px; color: #666; margin-bottom: 8px;">
                        Select block types to auto-create when this category is saved:
                    </p>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="cat-quick-digital-write" value="digital_write">
                            <span>Digital Write block</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="cat-quick-digital-read" value="digital_read">
                            <span>Digital Read block</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="cat-quick-analog-read" value="analog_read">
                            <span>Analog Read block</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="modal-category">Cancel</button>
                <button id="btn-save-category" class="btn btn-primary">Save Category</button>
            </div>
        </div>
    </div>

    <!-- Modal: New/Edit Block -->
    <div id="modal-block" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="block-modal-title">New Block</h3>
                <button class="btn-close" data-modal="modal-block">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Block Basic Info -->
                <div class="form-section">
                    <h4>Basic Information</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Block ID</label>
                            <input type="text" id="block-id" placeholder="e.g., emmi_eyes_on" />
                        </div>
                        <div class="form-group">
                            <label>Block Name</label>
                            <input type="text" id="block-name" placeholder="e.g., Eyes On" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Colour</label>
                            <input type="color" id="block-colour" value="#424242" />
                        </div>
                        <div class="form-group">
                            <label>Tooltip</label>
                            <input type="text" id="block-tooltip" placeholder="Description of what the block does" />
                        </div>
                    </div>
                </div>

                <!-- Block Template -->
                <div class="form-section">
                    <h4>Block Template</h4>
                    <div class="form-group">
                        <label>Choose a template (pre-fills fields & code)</label>
                        <select id="block-template" onchange="app.onTemplateChange(this.value)">
                            <option value="custom">Custom (manual)</option>
                            <option value="digital_write">Digital Write (like emmi_eyes_digital)</option>
                            <option value="digital_read">Digital Read (like emmi_touch_read)</option>
                            <option value="analog_read">Analog Read (like emmi_light_read)</option>
                        </select>
                    </div>
                </div>

                <!-- Block Configuration -->
                <div class="form-section">
                    <h4>Block Type</h4>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="block-type" value="simple" checked> Simple (no inputs)
                        </label>
                        <label>
                            <input type="radio" name="block-type" value="value"> With value input (returns a value)
                        </label>
                        <label>
                            <input type="radio" name="block-type" value="statement"> With statement input (has body)
                        </label>
                    </div>
                </div>

                <!-- Pin/Dropdown Configuration (shown for templates) -->
                <div class="form-section" id="pin-config-section" style="display:none;">
                    <h4>Pin / Dropdown Configuration</h4>
                    <p class="section-hint">Configure the pin dropdown options for this block.</p>

                    <div id="pin-options-list">
                        <!-- Dynamically populated pin options will appear here -->
                    </div>

                    <button type="button" class="btn btn-small btn-secondary" onclick="app.addPinOption()">
                        <i class="fas fa-plus"></i> Add Pin Option
                    </button>

                    <!-- State dropdown config (for digital_write only) -->
                    <div id="state-config-section" style="display:none; margin-top:12px;">
                        <h5>State Dropdown</h5>
                        <div id="state-options-list">
                            <!-- Dynamically populated state options -->
                        </div>
                        <button type="button" class="btn btn-small btn-secondary" onclick="app.addStateOption()">
                            <i class="fas fa-plus"></i> Add State Option
                        </button>
                    </div>

                    <!-- Mode dropdown config (for digital_read only) -->
                    <div id="mode-config-section" style="display:none; margin-top:12px;">
                        <h5>Input Mode Dropdown</h5>
                        <div id="mode-options-list">
                            <!-- Dynamically populated mode options -->
                        </div>
                        <button type="button" class="btn btn-small btn-secondary" onclick="app.addModeOption()">
                            <i class="fas fa-plus"></i> Add Mode Option
                        </button>
                    </div>

                    <!-- Setup code for pins -->
                    <div class="form-group" style="margin-top:12px;">
                        <label>Setup Code (runs once in setup())</label>
                        <textarea id="block-setup-code" class="code-editor" style="display:block; height:60px;"
                            placeholder="e.g. pinMode({{PIN}}, OUTPUT);"></textarea>
                    </div>
                </div>

                <!-- Code Generation -->
                <div class="form-section">
                    <h4>Code Generation</h4>
                    <div class="code-tabs">
                        <button class="code-tab active" data-lang="arduino">Arduino C++</button>
                        <button class="code-tab" data-lang="python">Python</button>
                        <button class="code-tab" data-lang="java">Java</button>
                        <button class="code-tab" data-lang="custom">Custom</button>
                    </div>
                    <div class="code-editor-container">
                        <textarea id="code-arduino" class="code-editor active"
                            placeholder="// Arduino C++ code template&#10;digitalWrite(LED_PIN, HIGH);"></textarea>
                        <textarea id="code-python" class="code-editor"
                            placeholder="# Python code template&#10;led.on()"></textarea>
                        <textarea id="code-java" class="code-editor"
                            placeholder="// Java code template&#10;robot.setLED(true);"></textarea>
                        <textarea id="code-custom" class="code-editor" placeholder="// Custom text output"></textarea>
                    </div>
                    <div class="code-help">
                        <small><i class="fas fa-info-circle"></i> Use <code>{{VARIABLE}}</code> for field values</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="modal-block">Cancel</button>
                <button id="btn-save-block" class="btn btn-primary">Save Block</button>
            </div>
        </div>
    </div>

    <!-- Hidden File Input -->
    <input type="file" id="file-import" accept=".json" style="display: none;">

    <!-- Modal: Cloud Settings -->
    <div id="modal-cloud" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>AWS Cloud Settings</h3>
                <button class="btn-close" data-modal="modal-cloud">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>AWS Access Key ID</label>
                    <input type="text" id="cloud-access-key" placeholder="AKIA..." />
                </div>
                <div class="form-group">
                    <label>AWS Secret Access Key</label>
                    <input type="password" id="cloud-secret-key" placeholder="AWS Secret" />
                </div>
                <div class="form-group">
                    <label>AWS Region</label>
                    <input type="text" id="cloud-region" placeholder="ap-south-1" />
                </div>
                <div class="form-group">
                    <label>S3 Bucket Name</label>
                    <input type="text" id="cloud-bucket" placeholder="my-emmi-bucket" />
                </div>
                <div class="code-help">
                    <small><i class="fas fa-info-circle"></i> Saved to local storage and used by Play in Cloud mode.</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="modal-cloud">Cancel</button>
                <button id="btn-save-cloud" class="btn btn-primary">Save Cloud Settings</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/block-creator.js"></script>
</body>

</html>
